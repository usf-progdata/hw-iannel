---
title: "Final Project"
author: "Ian Nel"
date: "5/6/2021"
output: 
  html_document:
    theme: paper
  github_document: default 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(MVN)
library(lavaan)
library(tidySEM)
library(semTable)
library(semPlot)
```

```{r data input}
data_raw <- read_csv(
  here::here("data", "DT-Res_synthetic.csv"),
  col_types = cols(
    Sample = col_factor(),
    Sex = col_factor(),
    Ethnicity = col_factor(),
    .default = col_double()
  )
)
str(data_raw)
```

```{r data wrangling}

data_clean <- data_raw %>%
  select(c(
    Sample, 
    DTNEW_2R:DTNew_82, 
    DTS_1:DTS_16, 
    FDSR_1:FDSR_35, 
    TDASS_1:TDASS_25, 
    DRS_1:DRS_15,
    GRIT_1:GRIT_12,
    RS_1:RS_26,
    Tanx:Bpd)) %>% 
  mutate(
    Sample = recode(Sample, "4" = "Clinical", "3" = "College", .default = "Community")
  ) %>% 
  rowwise() %>% 
  mutate(
    DTQ_tot = mean(c_across(DTNEW_2R:DTNew_82)),
    DTS_tot = mean(c_across(DTS_1:DTS_16)),
    FDSR_tot = mean(c_across(FDSR_1:FDSR_35)),
    TDASS_tot = mean(c_across(TDASS_1:TDASS_25)),
    DRS_tot = mean(c_across(DRS_1:DRS_15)),
    GRIT_tot = mean(c_across(GRIT_1:GRIT_12)),
    RS_tot = mean(c_across(DRS_1:DRS_15)),
    .before = everything(),
  ) 
str(data_clean)
  
```
```{r summary table} 
Table_1 <- data_clean %>%
  group_by(Sample) %>% 
  summarize(
    across(c(DTQ_tot:RS_tot,Tanx:Bpd), 
    list(
        Mean = ~ mean(.x, na.rm = TRUE),
        SD = ~ sd(.x, na.rm = TRUE)),
    .groups = keep
    )
  )
```


```{r testing multivariate normality assumption}
vars <- data_clean %>% 
  select(DTNEW_2R:RS_26) %>% 
  as.data.frame()

mvn_result <- mvn(vars, subset = NULL, mvnTest = "mardia", covariance = TRUE, tol = 1e-25, alpha = 0.5,
  scale = FALSE, desc = TRUE, transform = "none", R = 1000,
  univariateTest = "SW",univariatePlot = "qq", multivariatePlot = FALSE,
  multivariateOutlierMethod = "quan", bc = FALSE, bcType = NULL,
  showOutliers = FALSE, showNewData = FALSE)

mvn_result$multivariateNormality

```


```{r factor analysis}

```

```{r }

```

```{r}

```

```{r}

```
